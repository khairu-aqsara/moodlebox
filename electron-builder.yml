appId: com.moodlebox.app
productName: MoodleBox
copyright: Copyright Â© 2025 MoodleBox Team

directories:
  buildResources: build
  output: dist

# Files to include in all builds
files:
  - '!**/.vscode/*'
  - '!src/*'
  - '!electron.vite.config.{js,ts,mjs,cjs}'
  - '!{.eslintcache,eslint.config.mjs,.prettierignore,.prettierrc.yaml,dev-app-update.yml,CHANGELOG.md,README.md}'
  - '!{.env,.env.*,.npmrc,pnpm-lock.yaml}'
  - '!{tsconfig.json,tsconfig.node.json,tsconfig.web.json}'
  - '!planning/*'
  - '!.github/*'
  - '!BUILD_GUIDE.md'
  - '!PRD.md'
  - '!CLAUDE.md'
  - '!generate-icon.py'
  - '!build/icons/*'
  - '!build/icon-source.png'
  # Exclude unnecessary node_modules files
  - '!node_modules/**/{CHANGELOG.md,README.md,README,readme.md,readme}'
  - '!node_modules/**/{test,__tests__,tests,powered-test,example,examples}'
  - '!node_modules/**/*.d.ts'
  - '!node_modules/**/*.md'
  - '!node_modules/.bin'
  - '!node_modules/.cache'
  # Exclude all locales except English
  - '!**/node_modules/**/locales/**'
  - '**/node_modules/**/locales/en*.pak'
  # Exclude source maps
  - '!**/*.map'
  - '!**/*.js.map'
  # Include necessary directories
  - out/**/*
  - assets/**
  - package.json

asarUnpack:
  - resources/**
  - assets/**

# ASAR is required
asar: true

# Only include English locale for Electron
electronLanguages:
  - en
  - en-US

# ===== macOS Configuration =====
mac:
  target:
    - target: dmg
      arch: [x64, arm64] # Intel and Apple Silicon
  category: public.app-category.developer-tools
  icon: build/icon.icns
  # Enable hardened runtime and gatekeeper when signing (required for notarization)
  # These are safe to enable even for unsigned builds
  hardenedRuntime: true
  gatekeeperAssess: true
  entitlements: build/entitlements.mac.plist
  entitlementsInherit: build/entitlements.mac.plist
  extendInfo:
    - NSCameraUsageDescription: Application requests access to the device's camera.
    - NSMicrophoneUsageDescription: Application requests access to the device's microphone.
    - NSDocumentsFolderUsageDescription: Application requests access to the user's Documents folder.
    - NSDownloadsFolderUsageDescription: Application requests access to the user's Downloads folder.
  # Code signing configuration (optional via environment variables)
  # Set CSC_NAME to enable signing: export CSC_NAME="Developer ID Application: Your Name (TEAM_ID)"
  # If not set, builds will be unsigned (works for CI/CD)
  identity: ${env.CSC_NAME}
  # Notarization (optional, requires Apple Developer account)
  # Set APPLE_ID, APPLE_APP_SPECIFIC_PASSWORD, and APPLE_TEAM_ID environment variables to enable
  # electron-builder will automatically enable notarization when APPLE_TEAM_ID is set
  # If not set, notarization is skipped (works for CI/CD)
  notarize:
    teamId: ${env.APPLE_TEAM_ID}

dmg:
  artifactName: ${name}-${version}-${arch}.${ext}
  # Sign DMG if CSC_NAME is set, otherwise unsigned
  sign: ${env.CSC_NAME}

# ===== Windows Configuration =====
win:
  target:
    - target: nsis
      arch: [x64, arm64] # x64 and ARM64
  icon: build/icon.ico
  executableName: MoodleBox
  publisherName: MoodleBox Team
  # Code signing configuration (optional via environment variables)
  # Set CSC_LINK to path of .pfx certificate file, or CSC_NAME for certificate store
  # Set CSC_KEY_PASSWORD if certificate is password-protected
  # If not set, builds will be unsigned (works for CI/CD)
  certificateFile: ${env.CSC_LINK}
  certificatePassword: ${env.CSC_KEY_PASSWORD}
  sign: ${env.CSC_LINK}

nsis:
  artifactName: ${name}-${version}-${arch}-setup.${ext}
  shortcutName: ${productName}
  uninstallDisplayName: ${productName}
  createDesktopShortcut: always
  createStartMenuShortcut: true
  perMachine: false
  oneClick: false
  allowToChangeInstallationDirectory: true

# ===== Linux Configuration =====
linux:
  target:
    - target: AppImage
      arch: [x64, arm64]
    - target: deb
      arch: [x64, arm64]
    - target: rpm
      arch: [x64, arm64]
  icon: build/icon.png
  category: Development
  executableName: moodlebox
  maintainer: MoodleBox Team <support@moodlebox.dev>
  vendor: MoodleBox Team
  synopsis: Local Moodle development environment
  description: |
    MoodleBox is a cross-platform desktop application that simplifies 
    local Moodle development environments with one-click Docker setup.

appImage:
  artifactName: ${name}-${version}-${arch}.${ext}

deb:
  artifactName: ${name}-${version}-${arch}.${ext}
  depends:
    - docker.io

rpm:
  artifactName: ${name}-${version}-${arch}.${ext}
  depends:
    - docker

# Build Configuration
npmRebuild: true
buildDependenciesFromSource: false

# Auto-update configuration (disabled for unsigned builds)
publish:
  provider: generic
  url: https://example.com/auto-updates
